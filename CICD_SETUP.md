# üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD –¥–ª—è API —Ç–µ—Å—Ç–æ–≤

## –®–∞–≥ 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ GitHub

1. –ó–∞–π–¥–∏ –≤ —Å–≤–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub: https://github.com/Alextesterpro/eputs_api

2. –ü–µ—Ä–µ–π–¥–∏ –≤ **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**

3. –ù–∞–∂–º–∏ **New repository secret** –∏ –¥–æ–±–∞–≤—å:

   **–°–µ–∫—Ä–µ—Ç 1:**
   - Name: `API_USERNAME`
   - Value: `a.veselov@formattwo.ru`

   **–°–µ–∫—Ä–µ—Ç 2:**
   - Name: `API_PASSWORD`
   - Value: `—Ç–≤–æ–π_—Ä–µ–∞–ª—å–Ω—ã–π_–ø–∞—Ä–æ–ª—å`

‚úÖ –¢–µ–ø–µ—Ä—å GitHub –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

---

## –®–∞–≥ 2: –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—É—Å–∫–∏:

1. **–ü—Ä–∏ –ø—É—à–µ –≤ main/develop:**
   - –ö–∞–∂–¥—ã–π —Ä–∞–∑ –∫–æ–≥–¥–∞ —Ç—ã –¥–µ–ª–∞–µ—à—å `git push`, —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

2. **–ü–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é:**
   - –ö–∞–∂–¥—ã–π –±—É–¥–Ω–∏–π –¥–µ–Ω—å –≤ 12:00 –ú–°–ö (9:00 UTC)
   - –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ `.github/workflows/api-tests.yml`

3. **–í—Ä—É—á–Ω—É—é:**
   - –ó–∞—Ö–æ–¥–∏—à—å –≤ GitHub ‚Üí Actions ‚Üí "API Tests" ‚Üí "Run workflow"

### –ü—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

```
1. Checkout –∫–æ–¥–∞
2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python 3.11
3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (pytest, requests, allure)
4. üîë –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ API (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –∏–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤)
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
6. üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
7. üìä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Allure –æ—Ç—á–µ—Ç–∞
8. üì¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
```

---

## –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞ —Ñ–∞–π–ª–æ–≤:

```bash
# 1. –î–æ–±–∞–≤—å workflow —Ñ–∞–π–ª –≤ git
git add .github/workflows/api-tests.yml
git add CICD_SETUP.md
git commit -m "–î–æ–±–∞–≤–∏–ª–∏ CI/CD workflow –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤"
git push origin main

# 2. –ó–∞–π–¥–∏ –Ω–∞ GitHub
https://github.com/Alextesterpro/eputs_api/actions

# 3. –£–≤–∏–¥–∏—à—å –∑–∞–ø—É—â–µ–Ω–Ω—ã–π workflow "API Tests"
```

### –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é:

1. –ó–∞–π–¥–∏: https://github.com/Alextesterpro/eputs_api/actions
2. –í—ã–±–µ—Ä–∏ "API Tests" –≤ —Å–ø–∏—Å–∫–µ —Å–ª–µ–≤–∞
3. –ù–∞–∂–º–∏ "Run workflow" ‚Üí "Run workflow"
4. –ù–∞–±–ª—é–¥–∞–π –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

## –®–∞–≥ 4: –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –í GitHub Actions:

- ‚úÖ –ó–µ–ª–µ–Ω–∞—è –≥–∞–ª–æ—á–∫–∞ = –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏
- ‚ùå –ö—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫ = –µ—Å—Ç—å –ø–∞–¥–µ–Ω–∏—è
- üü° –ñ–µ–ª—Ç—ã–π –∫—Ä—É–≥ = —Ç–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è

### Allure –æ—Ç—á–µ—Ç:

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –∫—Ä–∞—Å–∏–≤—ã–π –æ—Ç—á–µ—Ç —Å:
- –ì—Ä–∞—Ñ–∏–∫–∞–º–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
- –î–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—à–∏–±–∫–∞—Ö
- –ò—Å—Ç–æ—Ä–∏–µ–π –∑–∞–ø—É—Å–∫–æ–≤
- –¢—Ä–µ–Ω–¥–∞–º–∏

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram/Slack:

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã.

**–ü—Ä–∏–º–µ—Ä –¥–ª—è Telegram:**

```yaml
- name: –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
  if: always()
  run: |
    curl -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
      -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
      -d text="üß™ API Tests: ${{ job.status }}"
```

### –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:

```bash
# –í GitHub Actions –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä
pytest tests/tests_incidents/ -v -m "smoke"
```

### –ó–∞–ø—É—Å–∫ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö:

```yaml
strategy:
  matrix:
    environment: [dev, staging, prod]
```

---

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞

–ï—Å–ª–∏ –Ω–µ —Ö–æ—á–µ—à—å —Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö:

1. –ü–æ–ª—É—á–∏ —Ç–æ–∫–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ:
   ```bash
   python3 update_token.py
   cat .env
   ```

2. –î–æ–±–∞–≤—å —Ç–æ–∫–µ–Ω –∫–∞–∫ —Å–µ–∫—Ä–µ—Ç `API_TOKEN` –≤ GitHub

3. –ò–∑–º–µ–Ω–∏ workflow:
   ```yaml
   - name: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–∫–µ–Ω–∞
     run: |
       echo "EPUTS_TOKEN=${{ secrets.API_TOKEN }}" > .env
   ```

**–ú–∏–Ω—É—Å:** –¢–æ–∫–µ–Ω –ø—Ä–æ—Ç—É—Ö–Ω–µ—Ç —á–µ—Ä–µ–∑ 15 –¥–Ω–µ–π, –ø—Ä–∏–¥–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª—è—Ç—å –≤—Ä—É—á–Ω—É—é.

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ **–ß—Ç–æ –ë–ï–ó–û–ü–ê–°–ù–û:**
- –°–µ–∫—Ä–µ—Ç—ã –≤ GitHub –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã
- –°–µ–∫—Ä–µ—Ç—ã –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –ª–æ–≥–∞—Ö
- –¢–æ–∫–µ–Ω—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –Ω–∞ –ª–µ—Ç—É

‚ùå **–ß—Ç–æ –ù–ï –î–ï–õ–ê–¢–¨:**
- –ù–µ –∫–æ–º–º–∏—Ç—å `.env` –≤ git (—É–∂–µ –≤ `.gitignore`)
- –ù–µ —Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –≤ –∫–æ–¥–µ
- –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã –≤ –ª–æ–≥–∞—Ö

---

## Troubleshooting

### –û—à–∏–±–∫–∞: "401 Unauthorized"
- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö GitHub
- –¢–æ–∫–µ–Ω –º–æ–≥ –ø—Ä–æ—Ç—É—Ö–Ω—É—Ç—å

### –û—à–∏–±–∫–∞: "Connection timeout"
- GitHub –Ω–µ –º–æ–∂–µ—Ç –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è –¥–æ API
- –í–æ–∑–º–æ–∂–Ω–æ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ (firewall)

### –¢–µ—Å—Ç—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å YAML —Ñ–∞–π–ª–∞
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Å–µ–∫—Ä–µ—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã
- –ü–æ—Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ –≤ GitHub Actions

---

## –ì–æ—Ç–æ–≤–æ! üéâ

–¢–µ–ø–µ—Ä—å —É —Ç–µ–±—è –µ—Å—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π CI/CD –¥–ª—è API —Ç–µ—Å—Ç–æ–≤!

